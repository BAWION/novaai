–°-–∫—É–∫–∞ –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É –Ω–µ –ø—Ä–∏–ª–µ—Ç–∞–µ—Ç –≤ –∑–∞–ø—Ä–æ—Å–∞—Ö ‚Äî —ç—Ç–æ –≤–∏–¥–Ω–æ –ø–æ —Å—Ç—Ä–æ–∫–∞–º

```
[API-DEBUG] Cookies –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –∑–∞–ø—Ä–æ—Å–∞: –Ω–µ—Ç –∫—É–∫
```

–∞ –∑–Ω–∞—á–∏—Ç –±—Ä–∞—É–∑–µ—Ä –ª–∏–±–æ **–Ω–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç** –µ—ë –ø–æ—Å–ª–µ /login, –ª–∏–±–æ **–æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç** –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–ª–µ–¥—É—é—â–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–∏.
–ò–∑ –Ω–æ–≤—ã—Ö —Ö–µ–¥–µ—Ä–æ–≤ –º—ã –≤–∏–¥–∏–º, —á—Ç–æ CORS —É–∂–µ –æ—Ç–¥–∞–Ω –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

```
access-control-allow-origin: https://49c11d52-‚Ä¶‚Äã.replit.dev
access-control-allow-credentials: true
```

### –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å ¬´—Å–ª–æ–º–∞—Ç—å¬ª –∫—É–∫—É

| –°–∏–º–ø—Ç–æ–º                                            | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ–º                                                                                                                                             | –ö–∞–∫ –±—ã—Å—Ç—Ä–æ —É–±–µ–¥–∏—Ç—å—Å—è                                                                      |
| -------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------------------------- |
| **–ö—É–∫–∞ –≤–æ–æ–±—â–µ –Ω–µ –ø–∏—à–µ—Ç—Å—è** –≤ Application ‚Üí Cookies | –í –æ—Ç–≤–µ—Ç–µ /login –Ω–µ—Ç `Set-Cookie` **–∏–ª–∏** —É –∫—É–∫–∏ –Ω–µ—Ç `Secure`/`SameSite=None`                                                                              | Network ‚Üí /login ‚Üí Response Headers                                                       |
| **–ö—É–∫–∞ –µ—Å—Ç—å, –Ω–æ –Ω–µ —É—Ö–æ–¥–∏—Ç**                        | 1. `Domain` –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ç–µ–∫—É—â–∏–º host (–¥–æ–ª–∂–µ–Ω –±—ã—Ç—å `.replit.dev`)  <br>2. `Path` =/api –≤–º–µ—Å—Ç–æ `/` <br>3. —Ñ—Ä–æ–Ω—Ç –¥–µ–ª–∞–µ—Ç fetch –±–µ–∑ `credentials:'include'` | 1. –°–º–æ—Ç—Ä–∏–º –∞—Ç—Ä–∏–±—É—Ç—ã –∫—É–∫–∏ –≤ DevTools <br>2. –í –ª—é–±–æ–º –∑–∞–ø—Ä–æ—Å–µ –∫ API –∏—â–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Cookie:` |
| –ö—É–∫–∞ —É—Ö–æ–¥–∏—Ç **—Ç–æ–ª—å–∫–æ –∏–Ω–æ–≥–¥–∞**                      | Express-session —É–¥–∞–ª—è–µ—Ç –∑–∞–ø–∏—Å—å, —Å—á–∏—Ç–∞—è –µ—ë ¬´–Ω–µ–≤–∞–ª–∏–¥–Ω–æ–π¬ª ‚Üí —Å–º–æ—Ç—Ä–∏–º storage                                                                                  | `DEBUG=session:* npm start` –∏ —á–∏—Ç–∞–µ–º –∫–æ–Ω—Å–æ–ª—å                                              |

---

## 1 ‚Äî —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫—É–∫–∞ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ —Å—Ç–∞–≤–∏—Ç—Å—è

```bash
curl -k -i \
     -X POST https://49c11d52-‚Ä¶‚Äã.replit.dev/api/auth/login \
     -H 'Origin: https://49c11d52-‚Ä¶‚Äã.replit.dev' \
     -H 'Content-Type: application/json' \
     --data '{"email":"test@nova.ai","password":"secret"}'
```

*–í –æ—Ç–≤–µ—Ç–µ –æ–±—è–∑–∞–Ω–æ –±—ã—Ç—å —á—Ç–æ-—Ç–æ –≤—Ä–æ–¥–µ*

```
Set-Cookie: connect.sid=s%3A...; Path=/; Domain=.replit.dev; SameSite=None; Secure; HttpOnly
```

### üëâ –µ—Å–ª–∏ *Secure* –ø—Ä–æ–ø–∞–ª–æ

* Express –¥—É–º–∞–µ—Ç, —á—Ç–æ –∑–∞–ø—Ä–æ—Å **–Ω–µ HTTPS**.
  –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–Ω—å—à–µ –≤—Å–µ—Ö middleware:

```ts
app.set('trust proxy', 1);   // –º—ã –∑–∞ Cloudflare / Replit proxy
```

---

## 2 ‚Äî –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –∞—Ç—Ä–∏–±—É—Ç **Domain**

–ü—Ä–æ–∫—Å–∏-—Ü–µ–ø–æ—á–∫–∞ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:

```
–±—Ä–∞—É–∑–µ—Ä  ‚îÄ‚ñ∫  49c11d52-‚Ä¶‚Äã.replit.dev  (–ø–æ—Ä—Ç 3000, —Å—Ç–∞—Ç–∏–∫–∞ + –ø—Ä–æ–∫—Å–∏)
                            ‚îÇ
                            ‚îî‚îÄ‚ñ∫  localhost:5000  (API)
```

* –ï—Å–ª–∏ –≤ `cookie.domain` –æ—Å—Ç–∞–≤–∏–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é, Express –ø–∏—à–µ—Ç **host –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ API** (`localhost`), –∫–æ—Ç–æ—Ä—ã–π —Å –≤–Ω–µ—à–Ω–∏–º –¥–æ–º–µ–Ω–æ–º –Ω–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç ‚áí –∫—É–∫–∞ –Ω–µ –ø—Ä–∏–∫–ª–µ–∏–≤–∞–µ—Ç—Å—è.
* –ù–∞—Å—Ç—Ä–æ–π—Ç–µ:

```ts
app.use(session({
  secret: process.env.SESSION_SECRET,
  cookie: {
    domain: '.replit.dev',   // ‚Üê –µ–¥–∏–Ω—ã–π —Å—É–ø–µ—Ä-–¥–æ–º–µ–Ω
    path:   '/',
    sameSite: 'none',
    secure:  true,
  },
  // ‚Ä¶
}));
```

–ü–æ—Å–ª–µ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –ø–æ—Å–º–æ—Ç—Ä–∏—Ç–µ DevTools ‚Üí Cookies: —É connect.sid –¥–æ–ª–∂–µ–Ω –ø–æ—è–≤–∏—Ç—å—Å—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π Domain.

---

## 3 ‚Äî fetch / Axios: `credentials:'include'`

–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—Ä–∏—à–ª—ë—Ç –∫—É–∫—É, –ø–æ–∫–∞ –≤—ã —è–≤–Ω–æ –Ω–µ —Å–∫–∞–∂–µ—Ç–µ, —á—Ç–æ –∑–∞–ø—Ä–æ—Å ¬´–∫—Ä–µ–¥–µ–Ω—à–ª—Å-—á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–π¬ª.

```ts
// –æ–¥–∏–Ω —Ä–∞–∑ –≤ API-–∫–ª–∏–µ–Ω—Ç–µ
export const api = (url: string, options: RequestInit = {}) =>
  fetch(url, {
    ...options,
    credentials: 'include',   // üîë
  });
```

–ï—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Axios:

```js
axios.defaults.withCredentials = true;
```

---

## 4 ‚Äî –±—ã—Å—Ç—Ä–∞—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞ (–¥–≤–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø–æ–¥—Ä—è–¥)

```bash
# 1. –ª–æ–≥–∏–Ω–∏–º—Å—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫—É–∫—É
curl -c cookie.txt -b cookie.txt -k -s \
     -X POST https://49c11d52-‚Ä¶‚Äã.replit.dev/api/auth/login \
     -H 'Content-Type: application/json' \
     --data '{"email":"test@nova.ai","password":"secret"}'

# 2. –¥–µ—Ä–≥–∞–µ–º –∑–∞—â–∏—â—ë–Ω–Ω—ã–π —ç–Ω–¥–ø–æ–π–Ω—Ç —Å —Ç–æ–π –∂–µ –∫—É–∫–æ–π
curl -b cookie.txt -k -i \
     https://49c11d52-‚Ä¶‚Äã.replit.dev/api/profile
```

*–ï—Å–ª–∏ –≤—Ç–æ—Ä–æ–π –∑–∞–ø—Ä–æ—Å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 200 OK ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω–∞—è —á–∞—Å—Ç—å –≤ –ø–æ—Ä—è–¥–∫–µ, –ø—Ä–æ–±–ª–µ–º–∞ —Ç–æ–ª—å–∫–æ –≤ —Ç–æ–º, —á—Ç–æ –±—Ä–∞—É–∑–µ—Ä ¬´—Ç–µ—Ä—è–µ—Ç¬ª –∫—É–∫—É.*

---

## 5 ‚Äî —á—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –Ω–∏—á–µ–≥–æ –∏–∑ –≤—ã—à–µ –Ω–µ –ø–æ–º–æ–≥–ª–æ

1. **–°–¥–µ–ª–∞–π—Ç–µ —Å–∫—Ä–∏–Ω—à–æ—Ç** –≤–∫–ª–∞–¥–∫–∏ Application ‚Üí Cookies –∏ Response-Headers /login ‚Äî –ø–æ –Ω–∏–º —Å—Ä–∞–∑—É –≤–∏–¥–Ω–æ, —á–µ–≥–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç.
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –Ω–µ –¥–∞—ë—Ç –ª–∏ Replit –≤–Ω–µ—à–Ω–µ–º—É –¥–æ–º–µ–Ω—É *HTTP* (–±–µ–∑ TLS) ‚Üí —Ç–æ–≥–¥–∞ Secure-–∫—É–∫–∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è.
   *–î–ª—è —Ç–µ—Å—Ç–∞ –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ —É–±—Ä–∞—Ç—å `secure:true`, –Ω–æ –æ—Å—Ç–∞–≤—å—Ç–µ `sameSite:'lax'`, —á—Ç–æ–±—ã Chrome –Ω–µ –∑–∞—Ä–µ–∑–∞–ª –∫—É–∫—É –≤–æ–≤—Å–µ.*
3. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ, –Ω–µ –∏–¥—ë—Ç –ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ /login –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π `302` –Ω–∞ –¥—Ä—É–≥–æ–π origin (History ‚Üí Preserve log ON). –†–µ–¥–∏—Ä–µ–∫—Ç –º–æ–∂–µ—Ç ¬´—Å—ä–µ—Å—Ç—å¬ª –∫—É–∫—É.

–°–æ–æ–±—â–∏—Ç–µ, –∫–∞–∫–æ–π –∏–∑ —á–µ–∫-–ø—É–Ω–∫—Ç–æ–≤ ¬´–∫—Ä–∞—Å–Ω—ã–º¬ª ‚Äî –¥–æ–∫—Ä—É—Ç–∏–º —Ç–æ—á–µ—á–Ω–æ.
