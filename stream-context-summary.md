# Контекст стрима: Развертывание NovaAI University на Vercel

## Текущая задача
**Развертывание образовательной платформы NovaAI University на продакшн с собственным доменом через Vercel**

## Что уже готово
- ✅ Полностью функциональная образовательная платформа на Replit
- ✅ 6 ключевых модулей: Skills DNA, умный подбор курсов, адаптивный прогресс, ИИ-тьютор, LabHub, Сообщество
- ✅ База данных PostgreSQL с полным контентом (5 готовых курсов)
- ✅ API интеграции с OpenAI и Anthropic для ИИ-функций
- ✅ Система авторизации и прогресса пользователей

## Проблемы с которыми столкнулись

### 1. Критическая ошибка JavaScript (РЕШЕНА)
**Проблема**: `Unexpected token '<' (at index-BUaxEZKq.js:1:1)`
- Vercel возвращал HTML вместо JavaScript файлов
- Причина: неправильная конфигурация маршрутов в vercel.json
- **Решение**: исправили vercel.json с правильными правилами для /assets/

### 2. Ошибки PWA манифеста (РЕШЕНА)
**Проблема**: `Manifest: Line: 1, column: 1, Syntax error`
- Неправильный Content-Type для manifest.json
- **Решение**: добавили правильные заголовки `application/manifest+json`

## Текущий статус
**КРИТИЧЕСКАЯ ПРОБЛЕМА: Vercel все еще возвращает HTML вместо JS/JSON файлов**

### Новые ошибки (скриншот 17:46):
- `Uncaught SyntaxError: Unexpected token '<'` - JS файлы загружаются как HTML
- `Manifest: Line: 1, column: 1, Syntax error` - повторяющиеся ошибки JSON

### Применено новое решение:
- Переписан vercel.json с использованием `headers` + `rewrites` вместо `routes`
- Упрощенная конфигурация для надежной работы с Vercel v2

### Архитектура развертывания:
- **Фронтенд**: Vercel (статические файлы + собственный домен)
- **Бэкенд**: Replit (API + база данных PostgreSQL)
- **Прокси**: API запросы /api/* перенаправляются с Vercel на Replit

### Ключевые файлы конфигурации:
- `vercel.json` - исправлен для правильной обработки всех типов файлов
- `dist/public/` - собранные файлы для развертывания
- Переменные окружения: только NODE_ENV=production нужен на Vercel

## Что тестируем сейчас
1. **JavaScript файлы загружаются корректно** (статус: исправлено)
2. **Manifest.json работает без ошибок** (статус: исправлено)
3. **API проксирование функционирует** (статус: тестируется)
4. **Полная функциональность платформы** (статус: в проверке)

## Команды для развертывания
```bash
npm run build          # Сборка проекта
vercel --prod          # Развертывание на Vercel
```

## Следующие шаги
**НЕМЕДЛЕННО:**
1. Выполнить `vercel --prod` с новой минимальной конфигурацией
2. Проверить что JS файлы загружаются как JavaScript, не HTML
3. Убедиться что manifest.json возвращает валидный JSON

**ПОСЛЕ ИСПРАВЛЕНИЯ:**
4. Протестировать API функциональность (авторизация, Skills DNA)
5. Настроить собственный домен пользователя
6. Провести финальное тестирование всех функций платформы

## Текущая стратегия
Применена **минимальная конфигурация vercel.json** - убраны все сложные правила маршрутизации, оставлено только проксирование API. Vercel должен автоматически определить правильные Content-Type для статических файлов.

## Документация
- `vercel-critical-fix.md` - подробное описание исправлений
- `deploy-novaai-to-vercel.md` - пошаговая инструкция развертывания
- `vercel-deployment-fix.md` - решения проблем конфигурации

**Время работы**: ~2-3 часа диагностики и исправления критических ошибок конфигурации Vercel